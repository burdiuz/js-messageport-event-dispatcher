{"version":3,"file":"messageport-dispatcher.js","sources":["../source/MessagePortTarget.js","../node_modules/@actualwave/has-own/has-own.js","../node_modules/@actualwave/event-dispatcher/index.js","../source/utils.js","../source/MessagePortEvent.js","../source/MessagePortDispatcher.js"],"sourcesContent":["export class MessagePortTarget {\n  constructor(sender, receiver) {\n    this.sender = sender || [];\n    this.receiver = receiver || [];\n\n    if (!(this.sender instanceof Array)) {\n      this.sender = [this.sender];\n    }\n\n    if (!(this.receiver instanceof Array)) {\n      this.receiver = [this.receiver];\n    }\n  }\n\n  /*\n    @param data\n    @param origin\n  */\n  postMessage(...args) {\n    this.sender.forEach((item) => item.postMessage(...args));\n  }\n\n  addEventListener(type, handler) {\n    this.receiver.forEach((item) => item.addEventListener(type, handler));\n  }\n\n  removeEventListener(type, handler) {\n    this.receiver.forEach((item) => item.removeEventListener(type, handler));\n  }\n}\n\nexport default MessagePortTarget;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nconst hasOwn = (\n  (has) =>\n  (target, property) =>\n  Boolean(target && has.call(target, property))\n)(Object.prototype.hasOwnProperty);\n\nexports.hasOwn = hasOwn;\nexports.default = hasOwn;","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nfunction _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }\n\nvar hasOwn = _interopDefault(require('@actualwave/has-own'));\n\n/**\n *      \n */\n\n/* eslint-disable import/prefer-default-export */\nconst isObject = value => typeof value === 'object' && value !== null;\n\n/**\n * Created by Oleg Galaburda on 09.02.16.\n *      \n */\nclass Event {\n  constructor(type, data = null) {\n    this.type = type;\n    this.data = data;\n    this.defaultPrevented = false;\n  }\n\n  toJSON() {\n    return {\n      type: this.type,\n      data: this.data\n    };\n  }\n\n  isDefaultPrevented() {\n    return this.defaultPrevented;\n  }\n\n  preventDefault() {\n    this.defaultPrevented = true;\n  }\n\n}\nconst getEvent = (eventOrType, optionalData) => {\n  let event = eventOrType;\n\n  if (!isObject(eventOrType)) {\n    event = new Event(String(eventOrType), optionalData);\n  }\n\n  return event;\n};\n\n/**\n * Created by Oleg Galaburda on 09.02.16.\n *      \n */\nclass ListenersRunner {\n  constructor(listeners, onStopped, onComplete) {\n    this.index = -1;\n    this.immediatelyStopped = false;\n\n    this.stopImmediatePropagation = () => {\n      this.immediatelyStopped = true;\n    };\n\n    this.listeners = listeners;\n    this.onStopped = onStopped;\n    this.onComplete = onComplete;\n  }\n\n  run(event, target) {\n    let listener;\n    const {\n      listeners\n    } = this;\n    this.augmentEvent(event); // TODO this has to be handled in separate object ListenersRunner that should be\n    // created for each call() call and asked for index validation on each listener remove.\n\n    for (this.index = 0; this.index < listeners.length; this.index++) {\n      if (this.immediatelyStopped) break;\n      listener = listeners[this.index];\n      listener.call(target, event);\n    }\n\n    this.clearEvent(event);\n    this.onComplete(this);\n  }\n\n  augmentEvent(eventObject) {\n    const event = eventObject;\n    event.stopPropagation = this.onStopped;\n    event.stopImmediatePropagation = this.stopImmediatePropagation;\n  }\n  /* eslint class-methods-use-this: \"off\" */\n\n\n  clearEvent(eventObject) {\n    const event = eventObject;\n    delete event.stopPropagation;\n    delete event.stopImmediatePropagation;\n  }\n\n  listenerRemoved(listeners, index) {\n    if (listeners === this.listeners && index <= this.index) {\n      this.index--;\n    }\n  }\n\n}\n\n/**\n * Created by Oleg Galaburda on 09.02.16.\n *      \n */\nclass EventListeners {\n  constructor() {\n    this._listeners = {};\n    this._runners = [];\n\n    this.removeRunner = runner => {\n      this._runners.splice(this._runners.indexOf(runner), 1);\n    };\n  }\n\n  createList(eventType, priorityOpt) {\n    const priority = parseInt(priorityOpt, 10);\n    const target = this.getPrioritiesByKey(eventType);\n    const key = String(priority);\n    let value;\n\n    if (hasOwn(target, key)) {\n      value = target[key];\n    } else {\n      value = [];\n      target[key] = value;\n    }\n\n    return value;\n  }\n\n  getPrioritiesByKey(key) {\n    let value;\n\n    if (hasOwn(this._listeners, key)) {\n      value = this._listeners[key];\n    } else {\n      value = {};\n      this._listeners[key] = value;\n    }\n\n    return value;\n  }\n\n  add(eventType, handler, priority) {\n    const handlers = this.createList(eventType, priority);\n\n    if (handlers.indexOf(handler) < 0) {\n      handlers.push(handler);\n    }\n  }\n\n  has(eventType) {\n    let priority;\n    let result = false;\n    const priorities = this.getPrioritiesByKey(eventType);\n\n    if (priorities) {\n      for (priority in priorities) {\n        if (hasOwn(priorities, priority)) {\n          result = true;\n          break;\n        }\n      }\n    }\n\n    return result;\n  }\n\n  remove(eventType, handler) {\n    const priorities = this.getPrioritiesByKey(eventType);\n\n    if (priorities) {\n      const list = Object.getOwnPropertyNames(priorities);\n      const {\n        length\n      } = list;\n\n      for (let index = 0; index < length; index++) {\n        const priority = list[index];\n        const handlers = priorities[priority];\n        const handlerIndex = handlers.indexOf(handler);\n\n        if (handlerIndex >= 0) {\n          handlers.splice(handlerIndex, 1);\n\n          if (!handlers.length) {\n            delete priorities[priority];\n          }\n\n          this._runners.forEach(runner => {\n            runner.listenerRemoved(handlers, handlerIndex);\n          });\n        }\n      }\n    }\n  }\n\n  removeAll(eventType) {\n    delete this._listeners[eventType];\n  }\n\n  createRunner(handlers, onStopped) {\n    const runner = new ListenersRunner(handlers, onStopped, this.removeRunner);\n\n    this._runners.push(runner);\n\n    return runner;\n  }\n\n  call(event, target) {\n    const priorities = this.getPrioritiesByKey(event.type);\n    let stopped = false;\n\n    const stopPropagation = () => {\n      stopped = true;\n    };\n\n    if (priorities) {\n      // getOwnPropertyNames() or keys()?\n      const list = Object.getOwnPropertyNames(priorities).sort((a, b) => a - b);\n      const {\n        length\n      } = list;\n\n      for (let index = 0; index < length; index++) {\n        if (stopped) break;\n        const handlers = priorities[list[index]]; // in case if all handlers of priority were removed while event\n        // was dispatched and handlers become undefined.\n\n        if (handlers) {\n          const runner = this.createRunner(handlers, stopPropagation);\n          runner.run(event, target);\n          if (runner.immediatelyStopped) break;\n        }\n      }\n    }\n  }\n\n}\n\n/**\n * Created by Oleg Galaburda on 09.02.16.\n *      \n */\n\nclass EventDispatcher {\n  constructor(eventPreprocessor = null) {\n    this._eventPreprocessor = eventPreprocessor;\n    this._listeners = new EventListeners();\n  }\n\n  addEventListener(eventType, listener, priority = 0) {\n    this._listeners.add(eventType, listener, -priority || 0);\n  }\n\n  hasEventListener(eventType) {\n    return this._listeners.has(eventType);\n  }\n\n  removeEventListener(eventType, listener) {\n    this._listeners.remove(eventType, listener);\n  }\n\n  removeAllEventListeners(eventType) {\n    this._listeners.removeAll(eventType);\n  }\n\n  dispatchEvent(event, data) {\n    let eventObject = getEvent(event, data);\n\n    if (this._eventPreprocessor) {\n      eventObject = this._eventPreprocessor.call(this, eventObject);\n    }\n\n    this._listeners.call(eventObject);\n  }\n\n}\n\nconst createEventDispatcher = eventPreprocessor => new EventDispatcher(eventPreprocessor);\n\nexports.default = EventDispatcher;\nexports.Event = Event;\nexports.EventDispatcher = EventDispatcher;\nexports.createEventDispatcher = createEventDispatcher;\nexports.getEvent = getEvent;\nexports.isObject = isObject;\n//# sourceMappingURL=index.js.map\n","/**\n * Created by Oleg Galaburda on 09.02.16.\n */\nimport { isObject } from '@actualwave/event-dispatcher';\n\nexport const createId = () => `MP/${Math.ceil(Math.random() * 10000)}/${Date.now()}`;\n\n/**\n * If toJSON method implemented on object, it will be called instead of converting to JSON string.\n * This was made to utilize structured cloning algorithm for raw objects.\n * https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\n * In this case developer is responsible for converting linked objects.\n * @param object\n * @returns {Object}\n */\nexport const toRawData = (object) => {\n  if (typeof object.toJSON === 'function') {\n    return object.toJSON();\n  }\n\n  return JSON.stringify(object);\n};\n\n/**\n *\n * @param data {Object|String}\n * @returns {Object}\n */\nexport const parseRawData = (data) => {\n  let object; // keep it undefined in case of error\n\n  if (isObject(data)) {\n    return data;\n  }\n\n  try {\n    return JSON.parse(data);\n  } catch (error) {\n    // this isn't an event we are waiting for.\n  }\n\n  return object;\n};\n","/**\n * Created by Oleg Galaburda on 09.02.16.\n */\nimport hasOwn from '@actualwave/has-own';\nimport { isObject } from '@actualwave/event-dispatcher';\nimport { toRawData, parseRawData } from './utils';\n\nexport class MessagePortEvent {\n  constructor(event, dispatcherId) {\n    this.event = event;\n    this.dispatcherId = dispatcherId;\n  }\n\n  toJSON() {\n    return {\n      event: toRawData(this.event),\n      dispatcherId: this.dispatcherId,\n    };\n  }\n}\n\nexport const isMessagePortEvent = (object) =>\n  isObject(object) && hasOwn(object, 'dispatcherId') && hasOwn(object, 'event');\n\nexport const parseMessagePortEvent = (object) => {\n  const result = parseRawData(object);\n\n  if (result && isMessagePortEvent(result)) {\n    const { event, dispatcherId } = result;\n    return new MessagePortEvent(parseRawData(event), dispatcherId);\n  }\n\n  return null;\n};\n","/**\n * Created by Oleg Galaburda on 09.02.16.\n */\n/* eslint-disable no-restricted-globals */\n\nimport { createEventDispatcher, getEvent } from '@actualwave/event-dispatcher';\nimport { MessagePortEvent, parseMessagePortEvent } from './MessagePortEvent';\nimport { createId, toRawData } from './utils';\n\nexport class MessagePortDispatcher {\n  dispatcherId = createId();\n\n  targetOrigin = '*';\n\n  constructor(\n    target = null,\n    customPostMessageHandler = null,\n    receiverEventPreprocessor = null,\n    senderEventPreprocessor = null,\n  ) {\n    this.target = target || self;\n    this.customPostMessageHandler = customPostMessageHandler;\n    this.senderEventPreprocessor = senderEventPreprocessor;\n    this.sender = createEventDispatcher();\n    this.receiver = createEventDispatcher(receiverEventPreprocessor);\n\n    this.target.addEventListener('message', (event) => this._postMessageListener(event));\n  }\n\n  addEventListener(eventType, listener, priority) {\n    this.receiver.addEventListener(eventType, listener, priority);\n  }\n\n  hasEventListener(eventType) {\n    return this.receiver.hasEventListener(eventType);\n  }\n\n  removeEventListener(eventType, listener) {\n    this.receiver.removeEventListener(eventType, listener);\n  }\n\n  removeAllEventListeners(eventType) {\n    this.receiver.removeAllEventListeners(eventType);\n  }\n\n  dispatchEvent(eventType, data, transferList) {\n    let event = getEvent(eventType, data);\n\n    if (this.senderEventPreprocessor) {\n      event = this.senderEventPreprocessor.call(this, event);\n    }\n\n    const eventJson = toRawData(new MessagePortEvent(event, this.dispatcherId));\n\n    return this._postMessageHandler(eventJson, transferList);\n  }\n\n  /**\n   * @private\n   */\n  _postMessageHandler(data, transferList) {\n    const handler = this.customPostMessageHandler;\n\n    if (handler) {\n      return handler.call(this, data, this.targetOrigin, transferList);\n    }\n\n    return this.target.postMessage(data, this.targetOrigin, transferList);\n  }\n\n  /**\n   * @private\n   */\n  _postMessageListener(event) {\n    // INFO .nativeEvent react-native thing, it contains event object coming from WebView\n    event = event.nativeEvent || event;\n    const message = parseMessagePortEvent(event.data);\n\n    if (message) {\n      if (message.dispatcherId === this.dispatcherId) {\n        this.sender.dispatchEvent(message.event);\n      } else {\n        this.receiver.dispatchEvent(message.event);\n      }\n    }\n  }\n}\n\nexport const createMessagePortDispatcher = (\n  target,\n  customPostMessageHandler,\n  receiverEventPreprocessor,\n  senderEventPreprocessor,\n) =>\n  new MessagePortDispatcher(\n    target,\n    customPostMessageHandler,\n    receiverEventPreprocessor,\n    senderEventPreprocessor,\n  );\n\nconst factory = (getTarget, dispatcher = null) => () => {\n  if (!dispatcher) {\n    dispatcher = createMessagePortDispatcher(getTarget());\n  }\n\n  return dispatcher;\n};\n\nexport const getForSelf = factory(() => self);\n\nexport const getForParent = factory(() => parent);\n\nexport const getForTop = factory(() => top);\n"],"names":["MessagePortTarget","constructor","sender","receiver","Array","postMessage","args","forEach","item","addEventListener","type","handler","removeEventListener","require$$0","createId","Math","ceil","random","Date","now","toRawData","object","toJSON","JSON","stringify","parseRawData","data","isObject","parse","error","MessagePortEvent","event","dispatcherId","isMessagePortEvent","hasOwn","parseMessagePortEvent","result","MessagePortDispatcher","target","customPostMessageHandler","receiverEventPreprocessor","senderEventPreprocessor","targetOrigin","self","createEventDispatcher","_postMessageListener","eventType","listener","priority","hasEventListener","removeAllEventListeners","dispatchEvent","transferList","getEvent","call","eventJson","_postMessageHandler","nativeEvent","message","createMessagePortDispatcher","factory","getTarget","dispatcher","getForSelf","getForParent","parent","getForTop","top"],"mappings":"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"}