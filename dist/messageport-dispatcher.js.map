{"version":3,"file":"messageport-dispatcher.js","sources":["../node_modules/@actualwave/has-own/has-own.js","../node_modules/@actualwave/event-dispatcher/index.js","../source/utils.js","../source/MessagePortEvent.js","../source/MessagePortDispatcher.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nconst hasOwn = (\n  (has) =>\n  (target, property) =>\n  Boolean(target && has.call(target, property))\n)(Object.prototype.hasOwnProperty);\n\nexports.hasOwn = hasOwn;\nexports.default = hasOwn;","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nfunction _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }\n\nvar hasOwn = _interopDefault(require('@actualwave/has-own'));\n\n/**\n *      \n */\n\n/* eslint-disable import/prefer-default-export */\nconst isObject = value => typeof value === 'object' && value !== null;\n\n/**\n * Created by Oleg Galaburda on 09.02.16.\n *      \n */\nclass Event {\n  constructor(type, data = null) {\n    this.type = type;\n    this.data = data;\n    this.defaultPrevented = false;\n  }\n\n  toJSON() {\n    return {\n      type: this.type,\n      data: this.data\n    };\n  }\n\n  isDefaultPrevented() {\n    return this.defaultPrevented;\n  }\n\n  preventDefault() {\n    this.defaultPrevented = true;\n  }\n\n}\nconst getEvent = (eventOrType, optionalData) => {\n  let event = eventOrType;\n\n  if (!isObject(eventOrType)) {\n    event = new Event(String(eventOrType), optionalData);\n  }\n\n  return event;\n};\n\n/**\n * Created by Oleg Galaburda on 09.02.16.\n *      \n */\nclass ListenersRunner {\n  constructor(listeners, onStopped, onComplete) {\n    this.index = -1;\n    this.immediatelyStopped = false;\n\n    this.stopImmediatePropagation = () => {\n      this.immediatelyStopped = true;\n    };\n\n    this.listeners = listeners;\n    this.onStopped = onStopped;\n    this.onComplete = onComplete;\n  }\n\n  run(event, target) {\n    let listener;\n    const {\n      listeners\n    } = this;\n    this.augmentEvent(event); // TODO this has to be handled in separate object ListenersRunner that should be\n    // created for each call() call and asked for index validation on each listener remove.\n\n    for (this.index = 0; this.index < listeners.length; this.index++) {\n      if (this.immediatelyStopped) break;\n      listener = listeners[this.index];\n      listener.call(target, event);\n    }\n\n    this.clearEvent(event);\n    this.onComplete(this);\n  }\n\n  augmentEvent(eventObject) {\n    const event = eventObject;\n    event.stopPropagation = this.onStopped;\n    event.stopImmediatePropagation = this.stopImmediatePropagation;\n  }\n  /* eslint class-methods-use-this: \"off\" */\n\n\n  clearEvent(eventObject) {\n    const event = eventObject;\n    delete event.stopPropagation;\n    delete event.stopImmediatePropagation;\n  }\n\n  listenerRemoved(listeners, index) {\n    if (listeners === this.listeners && index <= this.index) {\n      this.index--;\n    }\n  }\n\n}\n\n/**\n * Created by Oleg Galaburda on 09.02.16.\n *      \n */\nclass EventListeners {\n  constructor() {\n    this._listeners = {};\n    this._runners = [];\n\n    this.removeRunner = runner => {\n      this._runners.splice(this._runners.indexOf(runner), 1);\n    };\n  }\n\n  createList(eventType, priorityOpt) {\n    const priority = parseInt(priorityOpt, 10);\n    const target = this.getPrioritiesByKey(eventType);\n    const key = String(priority);\n    let value;\n\n    if (hasOwn(target, key)) {\n      value = target[key];\n    } else {\n      value = [];\n      target[key] = value;\n    }\n\n    return value;\n  }\n\n  getPrioritiesByKey(key) {\n    let value;\n\n    if (hasOwn(this._listeners, key)) {\n      value = this._listeners[key];\n    } else {\n      value = {};\n      this._listeners[key] = value;\n    }\n\n    return value;\n  }\n\n  add(eventType, handler, priority) {\n    const handlers = this.createList(eventType, priority);\n\n    if (handlers.indexOf(handler) < 0) {\n      handlers.push(handler);\n    }\n  }\n\n  has(eventType) {\n    let priority;\n    let result = false;\n    const priorities = this.getPrioritiesByKey(eventType);\n\n    if (priorities) {\n      for (priority in priorities) {\n        if (hasOwn(priorities, priority)) {\n          result = true;\n          break;\n        }\n      }\n    }\n\n    return result;\n  }\n\n  remove(eventType, handler) {\n    const priorities = this.getPrioritiesByKey(eventType);\n\n    if (priorities) {\n      const list = Object.getOwnPropertyNames(priorities);\n      const {\n        length\n      } = list;\n\n      for (let index = 0; index < length; index++) {\n        const priority = list[index];\n        const handlers = priorities[priority];\n        const handlerIndex = handlers.indexOf(handler);\n\n        if (handlerIndex >= 0) {\n          handlers.splice(handlerIndex, 1);\n\n          if (!handlers.length) {\n            delete priorities[priority];\n          }\n\n          this._runners.forEach(runner => {\n            runner.listenerRemoved(handlers, handlerIndex);\n          });\n        }\n      }\n    }\n  }\n\n  removeAll(eventType) {\n    delete this._listeners[eventType];\n  }\n\n  createRunner(handlers, onStopped) {\n    const runner = new ListenersRunner(handlers, onStopped, this.removeRunner);\n\n    this._runners.push(runner);\n\n    return runner;\n  }\n\n  call(event, target) {\n    const priorities = this.getPrioritiesByKey(event.type);\n    let stopped = false;\n\n    const stopPropagation = () => {\n      stopped = true;\n    };\n\n    if (priorities) {\n      // getOwnPropertyNames() or keys()?\n      const list = Object.getOwnPropertyNames(priorities).sort((a, b) => a - b);\n      const {\n        length\n      } = list;\n\n      for (let index = 0; index < length; index++) {\n        if (stopped) break;\n        const handlers = priorities[list[index]]; // in case if all handlers of priority were removed while event\n        // was dispatched and handlers become undefined.\n\n        if (handlers) {\n          const runner = this.createRunner(handlers, stopPropagation);\n          runner.run(event, target);\n          if (runner.immediatelyStopped) break;\n        }\n      }\n    }\n  }\n\n}\n\n/**\n * Created by Oleg Galaburda on 09.02.16.\n *      \n */\n\nclass EventDispatcher {\n  constructor(eventPreprocessor = null) {\n    this._eventPreprocessor = eventPreprocessor;\n    this._listeners = new EventListeners();\n  }\n\n  addEventListener(eventType, listener, priority = 0) {\n    this._listeners.add(eventType, listener, -priority || 0);\n  }\n\n  hasEventListener(eventType) {\n    return this._listeners.has(eventType);\n  }\n\n  removeEventListener(eventType, listener) {\n    this._listeners.remove(eventType, listener);\n  }\n\n  removeAllEventListeners(eventType) {\n    this._listeners.removeAll(eventType);\n  }\n\n  dispatchEvent(event, data) {\n    let eventObject = getEvent(event, data);\n\n    if (this._eventPreprocessor) {\n      eventObject = this._eventPreprocessor.call(this, eventObject);\n    }\n\n    this._listeners.call(eventObject);\n  }\n\n}\n\nconst createEventDispatcher = eventPreprocessor => new EventDispatcher(eventPreprocessor);\n\nexports.default = EventDispatcher;\nexports.Event = Event;\nexports.EventDispatcher = EventDispatcher;\nexports.createEventDispatcher = createEventDispatcher;\nexports.getEvent = getEvent;\nexports.isObject = isObject;\n//# sourceMappingURL=index.js.map\n","/**\r\n * Created by Oleg Galaburda on 09.02.16.\r\n */\r\nimport { isObject } from '@actualwave/event-dispatcher';\r\n\r\nexport const createId = () => `MP/${Math.ceil(Math.random() * 10000)}/${Date.now()}`;\r\n\r\n/**\r\n * If toJSON method implemented on object, it will be called instead of converting to JSON string.\r\n * This was made to utilize structured cloning algorithm for raw objects.\r\n * https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\r\n * In this case developer is responsible for converting linked objects.\r\n * @param object\r\n * @returns {Object}\r\n */\r\nexport const toRawData = (object) => {\r\n  if (typeof object.toJSON === 'function') {\r\n    return object.toJSON();\r\n  }\r\n\r\n  return JSON.stringify(object);\r\n};\r\n\r\n/**\r\n *\r\n * @param data {Object|String}\r\n * @returns {Object}\r\n */\r\nexport const parseRawData = (data) => {\r\n  let object; // keep it undefined in case of error\r\n\r\n  if (isObject(data)) {\r\n    return data;\r\n  }\r\n\r\n  try {\r\n    return JSON.parse(data);\r\n  } catch (error) {\r\n    // this isn't an event we are waiting for.\r\n  }\r\n\r\n  return object;\r\n};\r\n","/**\r\n * Created by Oleg Galaburda on 09.02.16.\r\n */\r\nimport hasOwn from '@actualwave/has-own';\r\nimport { isObject } from '@actualwave/event-dispatcher';\r\nimport { toRawData, parseRawData } from './utils';\r\n\r\nexport class MessagePortEvent {\r\n  constructor(event, dispatcherId) {\r\n    this.event = event;\r\n    this.dispatcherId = dispatcherId;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      event: toRawData(this.event),\r\n      dispatcherId: this.dispatcherId,\r\n    };\r\n  }\r\n}\r\n\r\nexport const isMessagePortEvent = (object) =>\r\n  isObject(object) && hasOwn(object, 'dispatcherId') && hasOwn(object, 'event');\r\n\r\nexport const parseMessagePortEvent = (object) => {\r\n  const result = parseRawData(object);\r\n\r\n  if (result && isMessagePortEvent(result)) {\r\n    const { event, dispatcherId } = result;\r\n    return new MessagePortEvent(parseRawData(event), dispatcherId);\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport default MessagePortEvent;\r\n","/**\r\n * Created by Oleg Galaburda on 09.02.16.\r\n */\r\n/* eslint-disable no-restricted-globals */\r\n\r\nimport { createEventDispatcher, getEvent } from '@actualwave/event-dispatcher';\r\nimport { MessagePortEvent, parseMessagePortEvent } from './MessagePortEvent';\r\nimport { createId, toRawData } from './utils';\r\n\r\nexport class MessagePortDispatcher {\r\n  dispatcherId = createId();\r\n\r\n  targetOrigin = '*';\r\n\r\n  constructor(\r\n    target = null,\r\n    customPostMessageHandler = null,\r\n    receiverEventPreprocessor = null,\r\n    senderEventPreprocessor = null,\r\n  ) {\r\n    this.target = target || self;\r\n    this.customPostMessageHandler = customPostMessageHandler;\r\n    this.senderEventPreprocessor = senderEventPreprocessor;\r\n    this.sender = createEventDispatcher();\r\n    this.receiver = createEventDispatcher(receiverEventPreprocessor);\r\n\r\n    target.addEventListener('message', (event) => this._postMessageListener(event));\r\n  }\r\n\r\n  addEventListener(eventType, listener, priority) {\r\n    this.receiver.addEventListener(eventType, listener, priority);\r\n  }\r\n\r\n  hasEventListener(eventType) {\r\n    return this.receiver.hasEventListener(eventType);\r\n  }\r\n\r\n  removeEventListener(eventType, listener) {\r\n    this.receiver.removeEventListener(eventType, listener);\r\n  }\r\n\r\n  removeAllEventListeners(eventType) {\r\n    this.receiver.removeAllEventListeners(eventType);\r\n  }\r\n\r\n  dispatchEvent(eventType, data, transferList) {\r\n    let event = getEvent(eventType, data);\r\n\r\n    if (this.senderEventPreprocessor) {\r\n      event = this.senderEventPreprocessor.call(this, event);\r\n    }\r\n\r\n    const eventJson = toRawData(new MessagePortEvent(event, this.dispatcherId));\r\n\r\n    return this._postMessageHandler(eventJson, transferList);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  _postMessageHandler(data, transferList) {\r\n    const handler = this.customPostMessageHandler;\r\n\r\n    if (handler) {\r\n      return handler.call(this, data, this.targetOrigin, transferList);\r\n    }\r\n\r\n    return this.target.postMessage(data, this.targetOrigin, transferList);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  _postMessageListener(event) {\r\n    // INFO .nativeEvent react-native thing, it contains event object coming from WebView\r\n    event = event.nativeEvent || event;\r\n    const message = parseMessagePortEvent(event.data);\r\n\r\n    if (message) {\r\n      if (message.dispatcherId === this.dispatcherId) {\r\n        this.sender.dispatchEvent(message.event);\r\n      } else {\r\n        this.receiver.dispatchEvent(message.event);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const createMessagePortDispatcher = (\r\n  target,\r\n  customPostMessageHandler,\r\n  receiverEventPreprocessor,\r\n  senderEventPreprocessor,\r\n) =>\r\n  new MessagePortDispatcher(\r\n    target,\r\n    customPostMessageHandler,\r\n    receiverEventPreprocessor,\r\n    senderEventPreprocessor,\r\n  );\r\n\r\nexport const factory = (getTarget, dispatcher = null) => () => {\r\n  if (!dispatcher) {\r\n    return createMessagePortDispatcher(getTarget());\r\n  }\r\n  return dispatcher;\r\n};\r\n\r\nexport const createForSelf = factory(() => self);\r\n\r\nexport const createForParent = factory(() => parent);\r\n\r\nexport const createForTop = factory(() => top);\r\n\r\nexport default MessagePortDispatcher;\r\n"],"names":["require$$0","createId","Math","ceil","random","Date","now","toRawData","object","toJSON","JSON","stringify","parseRawData","data","isObject","parse","error","MessagePortEvent","constructor","event","dispatcherId","isMessagePortEvent","hasOwn","parseMessagePortEvent","result","MessagePortDispatcher","target","customPostMessageHandler","receiverEventPreprocessor","senderEventPreprocessor","targetOrigin","self","sender","createEventDispatcher","receiver","addEventListener","_postMessageListener","eventType","listener","priority","hasEventListener","removeEventListener","removeAllEventListeners","dispatchEvent","transferList","getEvent","call","eventJson","_postMessageHandler","handler","postMessage","nativeEvent","message","createMessagePortDispatcher","factory","getTarget","dispatcher","createForSelf","createForParent","parent","createForTop","top"],"mappings":"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"}